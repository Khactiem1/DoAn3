@model List<DTO.DichVu>
@{
    ViewBag.Title = "Quản lý dịch vụ";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="info__bug">
    <div class="form__update-the">
        <div class="form info__thenap">
            <h3 class="bar__titel title__info">
                Thêm dịch vụ
            </h3>
            <div class="form__container noauto">
                <form class="form__info">
                    <div class="row rechargecard__history-select">
                        <div class="col l-2-4 m-12 c-12 rechargecard__history-item">
                            <svg class="Input_icon__3bJ0I" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                            <input type="text" placeholder="Mã khách hàng" class="select__input form__update-the">
                            <span class="form-message"></span>
                        </div>
                        <div class="col l-2-4 m-12 c-12 rechargecard__history-item">
                            <svg class="Input_icon__3bJ0I" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                            <input type="text" placeholder="Tên khách hàng" class="select__input form__update-the">
                            <span class="form-message"></span>
                        </div>
                        <div class="col l-2-4 m-12 c-12 rechargecard__history-item">
                            <select class="select__input form__update-the">
                                <option>Dịch vụ</option>
                                <option>Điện</option>
                                <option>Nước</option>
                                <option>vay tiêu dùng</option>
                                <option>Truyền hình</option>
                                <option>Internet</option>
                                <option>Chung cư</option>
                            </select>
                            <span class="form-message"></span>
                        </div>
                        <div class="col l-2-4 m-12 c-12 rechargecard__history-item">
                            <svg class="Input_icon__3bJ0I" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                            <input type="text" placeholder="Tiền thanh toán" class="select__input form__update-the inputMoney">
                            <span class="form-message"></span>
                        </div>
                        <div class="col l-2-4 m-12 c-12 rechargecard__history-item">
                            <svg class="Input_icon__3bJ0I" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                            <input type="text" placeholder="Nhà cung cấp" class="select__input form__update-the">
                            <span class="form-message"></span>
                        </div>
                        <div class="btn__update">
                            <div class="btn__items">
                                <button type="button" class="btn__search-history btn__full themSanPham">
                                    Thêm
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="form">
        <h3 class="bar__title title__info">
            Danh sách dịch vụ chờ thanh toán
        </h3>
        <form action="" class="history__search">
            <div class="row rechargecard__history-select">
                <div class="col l-3 m-12 c-12 rechargecard__history-item">
                    <input type="text" placeholder="Mã khách hàng" class="select__input searchID">
                </div>
                <div class="col l-3 m-12 c-12 rechargecard__history-item">
                    <input type="text" placeholder="Tên khách hàng" class="select__input searchName">
                </div>
                <div class="col l-3 m-12 c-12 rechargecard__history-item">
                    <input type="text" placeholder="Nhà cung cấp" class="select__input searchNCC">
                </div>
                <div class="col l-3 m-12 c-12 rechargecard__history-item">
                    <select class="select__input searchDV">
                        <option value="" >Dịch vụ</option>
                        <option value="dien">Điện</option>
                        <option value="nuoc">Nước</option>
                        <option value="vaytieudung">vay tiêu dùng</option>
                        <option value="truyenhinh">Truyền hình</option>
                        <option value="internet">Internet</option>
                        <option value="chungcu">Chung cư</option>
                    </select>
                </div>
                <div class="col l-4 m-12 c-12 rechargecard__history-item">
                    <select class="select__recort">
                        <option>5</option>
                        <option selected>10</option>
                        <option>15</option>
                        <option>20</option>
                        <option>25</option>
                        <option>30</option>
                    </select>
                </div>
            </div>
        </form>
        <div class="form__container container">
            <div class="form__history">
                <div class="table__history">
                    <div class="table__history-item">
                        <span>STT</span>
                    </div>
                    <div class="table__history-item">
                        <span>Mã khách hàng</span>
                    </div>
                    <div class="table__history-item">
                        <span>Tên khách hàng</span>
                    </div>
                    <div class="table__history-item">
                        <span>Dịch vụ</span>
                    </div>
                    <div class="table__history-item">
                        <span>Tiền thanh toán (VNĐ)</span>
                    </div>
                    <div class="table__history-item item-end">
                        <span>Nhà cung cấp</span>
                    </div>
                </div>
                <div class="card__content">
                    @{
                        int number = 1;
                        foreach (var item in Model)
                        {
                            <div class="table__history table-@number">
                                <div class="table__history-item">
                                    <span>@number</span>
                                </div>
                                <div class="table__history-item">
                                    <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                    <input value="@item.MaDichVu" disabled="" type="text" class="input__update">
                                </div>
                                <div class="table__history-item">
                                    <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                    <input value="@item.TenKhachHang" disabled="" type="text" class="input__update">
                                </div>
                                <div class="table__history-item">
                                    <select disabled="" class="input__update">
                                        @{
                                            string[] a = new string[] { "Điện", "Nước", "vay tiêu dùng", "Truyền hình", "Internet", "Chung cư" };
                                            for (int i = 0; i < 6; i++)
                                            {
                                                if (a[i] != item.TenDichVu)
                                                {
                                                    <option>@a[i]</option>
                                                }
                                                else if (a[i] == item.TenDichVu)
                                                {
                                                    <option selected="selected">@a[i]</option>
                                                }
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="table__history-item">
                                    <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                    <input value="@String.Format("{0:#,##0.##}", item.TienThanhToan)" disabled="" type="text" class="input__update">
                                </div>
                                <div class="table__history-item item-end">
                                    <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                    <input value="@item.DoiTac" disabled="" type="text" class="input__update">
                                    <i onclick="UpdateSP('table-@number')" class="far fa-edit edit__info update"></i>
                                    <i onclick="DoneSP('table-@number')" class="far fa-check-circle edit__info done none"></i>
                                    <i onclick="DeleteSP('table-@number', '@item.MaDichVu')" class="far fa-trash-alt edit__info delete"></i>
                                </div>
                            </div>
                            number++;
                        }
                    }
                </div>
            </div>
        </div>
        <p class="message__notification"></p>
        <form class="btn__n container">
            <div class="btn__next">
                <button type="button" class="btn__next-item btn__next-down"><i class="fas fa-chevron-left"></i></button>
                <span class="slide__number">@ViewBag.Number</span>
                <button type="button" class="btn__next-item btn__next-up"><i class="fas fa-chevron-right"></i></button>
            </div>
        </form>
    </div>
    <div class="waning">
        <i>
            * Nỗ lực tiêu chí tăng số lượng khách hàng trong năm tới mục tiêu trên 1000 lượt thanh toán mỗi tháng, bán được 100 thẻ nạp mỗi tuần
        </i>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var recort = document.querySelector('.select__recort');
        var moneyInput = document.querySelector(".inputMoney");
        // Restrict input to digits and '.' by using a regular expression filter.
        setInputFilter(moneyInput, function (value) {
            return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 9000000000)
        });
        /* Validate */
        (function () {
            const input = document.querySelectorAll('.select__input');
            function remove_oninput(element) {
                var message = element.querySelector('.form-message');
                message.innerText = '';
                element.classList.remove('invalid');
            }

            function add__blur(element, messages) {
                var message = element.querySelector('.form-message');
                message.innerText = messages;
                element.classList.add('invalid');
            }
            function CheckID(element, event) {
                $.ajax({
                    url: "/SearchOneDichVu?id=" + element.value.trim(),
                    method: "GET",
                    data: "",
                    contentType: "application/json",
                    dataType: ""
                }).done(function (response) {
                    event(response)
                }).fail(function (response) {
                    console.log("erro");
                })
            }
            var check__them = true;
            input.forEach((blurs, index) => {
                blurs.onblur = function () {
                    if (index == 0) {
                        function tests() {
                            return input[0].value.replace(/ /g, '').length >= 5 && input[0].value.length <= 20 ? undefined : `Nhập mã 5 - 20 ký tự`;
                        }
                        if (tests() == null) {
                            CheckID(input[0], function (res) {
                                if (res == false || res == "False") {
                                    add__blur(input[0].parentElement, "Mã Khách hàng đã tồn tại");
                                }
                            });
                        } else {
                            var mess = tests();
                            add__blur(input[0].parentElement, mess);
                        }
                    } else if (index == 1) {
                        function tests() {
                            return input[1].value.trim().length >= 5 && input[1].value.trim().length <= 20 ? undefined : `Nhập tên 5 - 20 ký tự`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[1].parentElement, mess);
                        }
                    } else if (index == 4) {
                        function tests() {
                            return input[4].value.trim().length >= 3 && input[4].value.trim().length <= 20 ? undefined : `Nhập 3 - 20 ký tự`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[4].parentElement, mess);
                        }
                    } else if (index == 3) {
                        function tests() {
                            return input[3].value.replace(/,/g, '') > 0 ? undefined : `Hãy nhập số tiền`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[3].parentElement, mess);
                        }
                    } else if (index == 2) {
                        function tests() {
                            return input[2].value != 'Dịch vụ' ? undefined : `Hãy chọn dịch vụ`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[2].parentElement, mess);
                        }
                    }
                }
                blurs.oninput = function () {
                    if (index == 0) {
                        remove_oninput(input[0].parentElement);
                        check__them = true;
                    }
                    if (index == 1) {
                        remove_oninput(input[1].parentElement);
                        check__them = true;
                    }
                    if (index == 2) {
                        remove_oninput(input[2].parentElement);
                        check__them = true;
                    }
                    if (index == 3) {
                        remove_oninput(input[3].parentElement);
                        check__them = true;
                    }
                    if (index == 4) {
                        remove_oninput(input[4].parentElement);
                        check__them = true;
                    }
                }
            })
            const Them = document.querySelector('.themSanPham');
            function ThemSP() {
                for (var i = 0; i < input.length; i++) {
                    if (i == 0) {
                        function tests() {
                            return input[0].value.replace(/ /g, '').length >= 5 && input[0].value.length <= 20 ? undefined : `Nhập mã 5 - 20 ký tự`;
                        }
                        if (tests() == null) {
                        }
                        else {
                            var mess = tests();
                            add__blur(input[0].parentElement, mess);
                            check__them = false;
                        }
                    } else if (i == 1) {
                        function tests() {
                            return input[1].value.trim().length >= 5 && input[1].value.trim().length <= 20 ? undefined : `Nhập tên 5 - 20 ký tự`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[1].parentElement, mess);
                            check__them = false;
                        }
                    } else if (i == 4) {
                        function tests() {
                            return input[4].value.trim().length >= 3 && input[4].value.trim().length <= 20 ? undefined : `Nhập 3 - 20 ký tự`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[4].parentElement, mess);
                            check__them = false;
                        }
                    } else if (i == 3) {
                        function tests() {
                            return input[3].value.replace(/,/g, '') > 0 ? undefined : `Hãy nhập số tiền`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[3].parentElement, mess);
                            check__them = false;
                        }
                    } else if (i == 2) {
                        function tests() {
                            return input[2].value != 'Dịch vụ' ? undefined : `Hãy chọn dịch vụ`;
                        }
                        if (tests() == null) { } else {
                            var mess = tests();
                            add__blur(input[2].parentElement, mess);
                            check__them = false;
                        }
                    }
                }
                if (check__them == true) {
                    CheckID(input[0], function (res) {
                        if (res == false || res == "False") {
                            add__blur(input[0].parentElement, "Mã Khách hàng đã tồn tại");
                            check__them = false;
                        }
                        else if (res == true || res == "True") {
                            var isRunning = false;
                            if (!isRunning) {
                                isRunning = true;
                                var SP = {};
                                SP.MaDichVu = input[0].value.replace(/ /g, '');
                                SP.TenKhachHang = input[1].value;
                                SP.DoiTac = input[4].value;
                                SP.TienThanhToan = input[3].value.replace(/,/g, '');
                                SP.TenDichVu = input[2].value;
                                SP.NgayThem = new Date();
                                active__Loading(true);
                                $.ajax({
                                    url: "/PostOneDichVu",
                                    method: "POST",
                                    data: JSON.stringify(SP),
                                    contentType: "application/json",
                                    dataType: "json"
                                }).done(function (response) {
                                    active__Loading(false);
                                    if (response == true) {
                                        LoadData(0, '', '', '', '', true, recort.value);
                                        input[0].value = "";
                                        input[1].value = "";
                                        input[4].value = "";
                                        input[3].value = "";
                                        active__messageNotification('Thêm thành công', true);
                                    }
                                    else {
                                        active__messageNotification("Có lỗi xảy ra, thử lại sau", false);
                                    }
                                }).fail(function (response) {
                                    active__Loading(false);
                                    active__messageNotification("Có lỗi xảy ra, thử lại sau", false);
                                })
                            }
                        }
                    });
                }
            }
            Them.onclick = function () {
                ThemSP();
            }
            function clickEnter(element, stt) {
                element.addEventListener("keyup", function (event) {
                    if (event.keyCode == 13 && stt < 5) {
                        ThemSP();
                    }
                });
            }
            clickEnter(input[0], 0);
            clickEnter(input[1], 1);
            clickEnter(input[2], 2);
            clickEnter(input[3], 3);
            clickEnter(input[4], 4);
            document.querySelector('.btn__next-up').onclick = function () {
                var Edit = document.querySelectorAll(".table__history-item span");
                var EditDelete = Edit[Edit.length - 1].innerText;
                var numb = document.querySelector('.slide__number').innerText;
                LoadData(numb, input[5].value, input[6].value, input[7].value, input[8].value, true, EditDelete);
            }
            document.querySelector('.btn__next-down').onclick = function () {
                var numb = document.querySelector('.slide__number').innerText;
                LoadData(numb, input[5].value, input[6].value, input[7].value, input[8].value, false, recort.value);
            }
            document.querySelector('.searchID').oninput = function () {
                setTimeout(function () {
                    $('.card__content').empty();
                    LoadData(0, input[5].value, input[6].value, input[7].value, input[8].value, true, recort.value);
                }, 100)
            }
            document.querySelector('.searchName').oninput = function () {
                setTimeout(function () {
                    $('.card__content').empty();
                    LoadData(0, input[5].value, input[6].value, input[7].value, input[8].value, true, recort.value);
                }, 100)
            }
            document.querySelector('.searchNCC').oninput = function () {
                setTimeout(function () {
                    $('.card__content').empty();
                    LoadData(0, input[5].value, input[6].value, input[7].value, input[8].value, true, recort.value);
                }, 100)
            }
            document.querySelector('.searchDV').oninput = function () {
                setTimeout(function () {
                    $('.card__content').empty();
                    LoadData(0, input[5].value, input[6].value, input[7].value, input[8].value, true, recort.value);
                }, 100)
            }
            $('.select__recort').change(function () {
                LoadData(0, '', '', '', '', true, recort.value);
            })
            function LoadData(trang, id, name, ncc, dv, trangthai, EditDelete) {
                if (trangthai == false) {
                    document.querySelector('.message__notification').innerText = "";
                }
                if (trangthai == false && trang == 1) {
                    return;
                }
                active__Loading(true);
                $.ajax({
                    url: "/GetAllDichVu?id=" + trang + "*" + id + "*" + name + "*" + ncc + "*" + dv + "*" + trangthai + "*" + EditDelete + "*" + recort.value,
                    method: "GET",
                    data: "",
                    contentType: "application/json",
                    dataType: ""
                }).done(function (response) {
                    active__Loading(false);
                    if (response.length == 0) {
                        if (document.querySelector('.message__notification').innerText == '') {
                            document.querySelector('.message__notification').innerText = "Danh sách tìm trống";
                        }
                        return;
                    }
                    if (trangthai == true) {
                        trang++;
                    }
                    else {
                        trang--;
                    }
                    if (response.length != 0) {
                        if (document.querySelector('.message__notification').innerText == 'Danh sách tìm trống') {
                            document.querySelector('.message__notification').innerText = '';
                        }
                    }
                    $('.card__content').empty();
                    $('.slide__number').empty();
                    $('.slide__number').append(trang);
                    var number = 0;
                    $.each(response, function (index, item) {
                        number++;
                        var DVARR = ["Điện", "Nước", "vay tiêu dùng", "Truyền hình", "Internet", "Chung cư"];
                        var htmlDV = ``;
                        for (var i = 0; i < DVARR.length; i++) {
                            if (DVARR[i] != item.TenDichVu) {
                                htmlDV = htmlDV + `<option>${DVARR[i]}</option >`
                            }
                            else if (DVARR[i] == item.TenDichVu) {
                                htmlDV = htmlDV + `<option selected="selected">${DVARR[i]}</option>`
                            }
                        }
                        var html = `<div class="table__history table-${number}">
                                            <div class="table__history-item">
                                                <span>${number}</span>
                                            </div>
                                            <div class="table__history-item">
                                                <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                                <input value="${item.MaDichVu}" disabled="" type="text" class="input__update">
                                            </div>
                                            <div class="table__history-item">
                                                <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                                <input value="${item.TenKhachHang}" disabled="" type="text" class="input__update">
                                            </div>
                                            <div class="table__history-item">
                                                <select disabled="" class="input__update">
                                                    ${htmlDV}
                                                </select>
                                            </div>
                                            <div class="table__history-item">
                                                <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                                <input value="${Number(item.TienThanhToan).toLocaleString('en')}" disabled="" type="text" class="input__update">
                                            </div>
                                            <div class="table__history-item item-end">
                                                <svg class="icon__update-invalid" width="16" height="16" viewBox="0 0 16 16"><path d="M0 0h16v16H0V0z" fill="none"></path><path d="M15.2 13.1L8.6 1.6c-.2-.4-.9-.4-1.2 0L.8 13.1c-.1.2-.1.5 0 .7.1.2.3.3.6.3h13.3c.2 0 .5-.1.6-.3.1-.2.1-.5-.1-.7zM8.7 12H7.3v-1.3h1.3V12zm0-2.7H7.3v-4h1.3v4z" fill="currentColor"></path></svg>
                                                <input value="${item.DoiTac}" disabled="" type="text" class="input__update">
                                                <i onclick="UpdateSP('table-${number}')" class="far fa-edit edit__info update"></i>
                                                <i onclick="DoneSP('table-${number}')" class="far fa-check-circle edit__info done none"></i>
                                                <i onclick="DeleteSP('table-${number}', '${item.MaDichVu}')" class="far fa-trash-alt edit__info delete"></i>
                                            </div>
                                        </div>`;
                        $('.card__content').append(html);
                    })
                }).fail(function (response) {
                    active__Loading(false);
                    active__messageNotification("Có lỗi xảy ra, thử lại sau", false);
                })
            }
        })();
    }, false)
    // Restricts input for the given textbox to the given inputFilter.
    function setInputFilter(textbox, inputFilter) {
        ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function (event) {
            textbox.addEventListener(event, function () {
                textbox.value = textbox.value.replace(/,/g, '');
                if (inputFilter(this.value)) {
                    this.oldValue = this.value;
                    this.oldSelectionStart = this.selectionStart;
                    this.oldSelectionEnd = this.selectionEnd;
                } else if (this.hasOwnProperty("oldValue")) {
                    this.value = this.oldValue;
                    this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                }
                var str = textbox.value;
                str = str.replace(/,/g, '');
                var number = Number(str).toLocaleString('en')
                textbox.value = number;
            });
        });
    }
    function UpdateSP(ClassElement) {
        var element = document.querySelector("." + ClassElement);
        ActiveUpdate(element);
    }
    function DoneSP(ClassElement) {
        var element = document.querySelector("." + ClassElement);
        DoneElement(element);
    }
    function DeleteSP(ClassElement, id) {
        const modal = document.querySelector('.modal');
        const form = document.querySelector('.modal .auth-form');
        modal.classList.add('modal__active');
        form.classList.add('auth-form__active');
        const close = document.querySelector('.modal__overlay');
        const closeIcon = document.querySelector('.auth-form__icon');
        close.onclick = function () {
            modal.classList.remove('modal__active');
            form.classList.remove('auth-form__active');
        }
        closeIcon.onclick = function () {
            modal.classList.remove('modal__active');
            form.classList.remove('auth-form__active');
        }
        const mess = document.querySelector('.message__delete');
        mess.innerText = 'Bạn có chắc muốn xoá mã khách hàng "' + id + '" ?';
        const button = document.querySelector('.auth-form__submit');
        button.onclick = function () {
            var isRunning = false;
            if (!isRunning) {
                isRunning = true;
                modal.classList.remove('modal__active');
                form.classList.remove('auth-form__active');
                active__Loading(true);
                $.ajax({
                    url: "/RemoveDichVu?id=" + id,
                    method: "POST",
                    data: "",
                    contentType: "application/json",
                    dataType: ""
                }).done(function (response) {
                    active__Loading(false);
                    if (response == true || response == "True") {
                        active__messageNotification('Xoá thành công', true);
                        $('.' + ClassElement).remove();
                        var STTEdit = document.querySelectorAll(".table__history-item span");
                        STTEdit.forEach((item, index) => {
                            if (index > 5) {
                                item.innerHTML = index - 5;
                            }
                        })
                    }
                    else if (response == false || response == "False") {
                        active__messageNotification('Có lỗi xảy ra, thử lại sau', false);
                    }
                }).fail(function (response) {
                    active__Loading(false);
                    active__messageNotification('Có lỗi xảy ra, thử lại sau', false);
                })
            }
        }
    }
    function DoneElement(element) {
        var check = true;
        var items = element.querySelectorAll(".table__history-item");
        items.forEach((item, index) => {
            if (index != 0 && index != 1) {
                var input = item.querySelector('.input__update');
                if (index == 2) {
                    function tests() {
                        return input.value.trim().length >= 5 && input.value.trim().length <= 20 ? undefined : `Nhập tên từ 5 - 20 ký tự`;
                    }
                    if (tests() == null) { } else {
                        add_oninputIcon(item)
                        check = false;
                    }
                } else if (index == 4) {
                    function tests() {
                        return input.value.replace(/,/g, '') > 0 ? undefined : `Hãy nhập số tiền`;
                    }
                    if (tests() == null) { } else {
                        add_oninputIcon(item)
                        check = false;
                    }
                } else if (index == 5) {
                    function tests() {
                        return input.value.trim().length >= 3 && input.value.trim().length <= 20 ? undefined : `Hãy chọn dịch vụ`;
                    }
                    if (tests() == null) { } else {
                        add_oninputIcon(item)
                        check = false;
                    }
                }

            }
        })
        if (check == true) {
            var SP = {};
            SP.MaDichVu = items[1].querySelector(".input__update").value.replace(/ /g, '');
            SP.TenKhachHang = items[2].querySelector(".input__update").value;
            SP.DoiTac = items[5].querySelector(".input__update").value;
            SP.TienThanhToan = items[4].querySelector(".input__update").value.replace(/,/g, '');
            SP.TenDichVu = items[3].querySelector(".input__update").value;
            active__Loading(true);
            $.ajax({
                url: "/PostEditDichVu",
                method: "POST",
                data: JSON.stringify(SP),
                contentType: "application/json",
                dataType: "json"
            }).done(function (response) {
                active__Loading(false);
                if (response == true || response == "True") {
                    active__messageNotification('sửa thành công', true);
                    items.forEach((item, index) => {
                        if (index != 0) {
                            var input = item.querySelector('.input__update');
                            input.disabled = true;
                            item.classList.remove("input__update-active");
                        }
                    })
                    element.querySelector('.done').classList.add('none');
                    element.querySelector('.update').classList.remove('none');
                }
                else if (response == false || response == "False") {
                    active__messageNotification('Có lỗi xảy ra, thử lại sau', false);
                }
            }).fail(function (response) {
                active__Loading(false);
                active__messageNotification('Có lỗi xảy ra, thử lại sau', false);
            })
        }
    }
    function ActiveUpdate(element) {
        var items = element.querySelectorAll(".table__history-item");
        element.querySelector('.done').classList.remove('none');
        element.querySelector('.update').classList.add('none');
        items.forEach((item, index) => {
            if (index != 0 && index != 1) {
                var input = item.querySelector('.input__update');
                input.disabled = false;
                item.classList.add("input__update-active");
                if (index == 4) {
                    setInputFilter(input, function (value) {
                        return /^\d*$/.test(value) && (value === "" || parseInt(value) <= 9000000000)
                    });
                }
                input.oninput = function () {
                    if (index != 3) {
                        remove_oninputIcon(item)
                    }
                }
                input.onblur = function () {
                    if (index == 2) {
                        function tests() {
                            return input.value.trim().length >= 5 && input.value.trim().length <= 20 ? undefined : `Nhập tên từ 5 - 20 ký tự`;
                        }
                        if (tests() == null) { } else {
                            add_oninputIcon(item)
                        }
                    } else if (index == 4) {
                        function tests() {
                            return input.value.replace(/,/g, '') > 0 ? undefined : `Hãy nhập số tiền`;
                        }
                        if (tests() == null) { } else {
                            add_oninputIcon(item)
                        }
                    } else if (index == 5) {
                        function tests() {
                            return input.value.trim().length >= 3 && input.value.trim().length <= 20 ? undefined : `Hãy chọn dịch vụ`;
                        }
                        if (tests() == null) { } else {
                            add_oninputIcon(item)
                        }
                    }
                }
            }
        })
    }
    function remove_oninputIcon(element) {
        var icon = element.querySelector('.icon__update-invalid');
        icon.classList.remove('icon__update-invalid__active');
    }
    function add_oninputIcon(element) {
        var icon = element.querySelector('.icon__update-invalid');
        icon.classList.add('icon__update-invalid__active');
    }
</script>
@*<script src="@Request.Url.Scheme://@Request.Url.Authority/Areas/Admin/Assets/js/validateDichVu.js"></script>*@